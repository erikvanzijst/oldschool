prefix = @prefix@
perl = @perl@
install = @INSTALL@
bin = kdoc qt2kdoc
pm = Ast.pm kdocHTML.pm kdocTeX.pm kdocMan.pm
man= kdoc.1 qt2kdoc.1
bindir = ${prefix}/bin
pmdir = ${prefix}/share/kdoc
mandir= ${prefix}/man/man1/
VERSION=@Version@

all: kdoc.local qt2kdoc.local

kdoc.local: kdoc
	cp kdoc kdoc.local
	perl -npi -e 's#\s*PREFIX\s*=.*$$#PREFIX="'${prefix}'";#g;' kdoc.local
	perl -npi -e 's#\$$Version\$$#'"${VERSION}"'#g;' kdoc.local
	
qt2kdoc.local: qt2kdoc
	cp qt2kdoc qt2kdoc.local
	perl -npi -e 's%^#\!.*$$%#!'${perl}'%g;' kdoc.local qt2kdoc.local

install: all
	${install} -d ${bindir}
	${install} -m 755 kdoc.local ${bindir}/kdoc
	${install} -m 755 qt2kdoc.local ${bindir}/qt2kdoc
	${install} -d ${pmdir}
	for file in ${pm}; do \
		${install} -m 644 $$file ${pmdir}; \
	done
	${install} -d ${mandir}
	for file in ${man}; do \
		${install} -m 644 $$file ${mandir}; \
	done

uninstall:
	(cd ${bindir} && rm -f ${bin})
	(cd  ${pmdir} && rm -f ${pm})
	(cd ${mandir} && rm -f ${man})
	-rmdir ${bindir}
	-rmdir ${pmdir}
	-rmdir ${mandir}
	

clean:
	-rm perlbin kdoc.local qt2kdoc.local

distclean: clean
	-rm Makefile config.status config.log config.cache

tags:
	perltags kdoc qt2kdoc *.pm
