<html>
<head>
<!-- This file has been generated by unroff 1.0, 08/19/97 15:00:59. -->
<!-- Do not edit! -->
<title>mnx_fresh(1) manual page</title>
</head>
<body>
<h2>
mnx_fresh, mnx_backup, mnx_restore - maintain MINIX O.S. on floppies
<hr></h2>
<h2>SYNOPSIS</h2>
<b>mnx_fresh</b> [<i>host</i>]
<br>
<b>mnx_backup</b> [<i>drive</i>]
<br>
<b>mnx_restore</b> [<i>drive</i>]
<h2>DESCRIPTION</h2>
These commands allow you to maintain a backup copy of the MINIX O.S. on
floppies.  You can use them to save your version of the O.S. on
floppies and to load that version on a MINIX PC the next day to continue
your work.<tt> </tt>
<p>
The
<i>drive
</i>argument (by default
<b>fd0</b>),
indicates which one of the floppy drives you want to use.  Use
<b>fd0
</b>to indicate drive
<b>/dev/fd0
</b>(A:), and
<b>fd1
</b>for drive
<b>/dev/fd1
</b>(B:).  In the examples drive 0 will be used.<tt> </tt>
<p>
To use these commands you need
<b>three
</b>formatted floppies.  Label them clearly as
<b>1</b>,
<b>2
</b>and
<b>3
</b>as you will need to insert exactly the right diskette when asked to.<tt> </tt>
<p>
On day 1 you will use
<b>mnx_fresh
</b>to fill the hard disk of the PC with a fresh
copy of MINIX.  For this the system needs to be booted using the stable
2.0.0 kernel with full networking support (the <b>'='</b> menu choice) as these
files are obtained from a remote UNIX machine where they are safe.<tt> </tt>
Become
<b>root
</b>and type
<p>
<dl><dt><dd>
<b>mnx_fresh
</b></dl>
<p>
and watch
<b>/usr
</b>being checked and repaired.  (You can run this command again later
if the machine is in a somewhat bad state.  The helpdesk people can revive
a system that is completely sick.)
<p>
<b>Mnx_fresh
</b>may be called with the name of a host as argument, for if the default host
is down or unreachable.<tt> </tt>
<p>
You are now ready to do your assignments, although you may want to try
<b>mnx_backup
</b>first.  Log in as
<b>bin
</b>now,
<b>bin
</b>can do almost anything you need to do and it has it's home directory
(/usr/src) right above the kernel sources.  A simple
<b>su
</b>command will make you
<b>root
</b>for those few special tasks that remain.  (Being root is no fun when you
don't need a password.)
<p>
After a day of work, use
<b>mnx_backup
</b>to save your O.S. on the three backup diskettes.  When you want to
continue the next day, you simply type
<b>mnx_restore
</b>to reload the O.S. on the hard disk.  (You may want to run
<b>mnx_fresh
</b>first to put the machine in a known state, who knows what people have done
to it.)
<p>
After saving you data,
<b>mnx_backup
</b>asks if it may delete all the files you have changed in the backed up
directories, so that no-one can steal your work.<tt> </tt>
<h3>Backup diskettes</h3>
The three backup diskettes must be 1.44Mb diskettes
formatted either from DOS or from MINIX with the command
<b>format</b>(1).<tt> </tt>
Use
<b>format /dev/fd0 1440
</b>to format a 1.44Mb floppy in drive 0.<tt> </tt>
Next you need to run
<b>mkfs /dev/fd0
</b>on each diskette to put a MINIX file system on it.  Now they are ready for use
under MINIX.<tt> </tt>
<h3>Mounting and unmounting</h3>
To make mounting and umounting floppies easier, the command
<b>M fd0
</b>mounts /dev/fd0 on /fd0, and
<b>U fd0
</b>umounts it, the same goes for fd1.  Never remove a floppy that is mounted!<tt> </tt>
Re-insert it immediately if you find out.<tt> </tt>
<h3>Making a test kernel</h3>
Type
<b>make hdboot
</b>in the tools directory to compile and install a test kernel, reboot the
machine and choose <b>'t'</b> on the boot menu to boot the experimental
kernel.  (The "stable" kernel is the
<b>/minix/2.0.0
</b>file.  The kernels you make are named
<b>/minix/2.0.0r</b>N
where
<i>N
</i>is a revision number.  The MINIX bootstrap likes to load the
newest kernel image present in
<b>/minix
</b>('t') unless you specify otherwise ('=').  Type
<b>set
</b>to the Boot Monitor for enlightenment.)
<p>
Rebooting the machine can be done by CTRL-ALT-DEL to quit MINIX, followed
by CTRL-ALT-DEL once more to really reboot.  It is faster to type
<b>exit
</b>at the monitor prompt though.  The truly shrewd would use the MINIX command
<p>
<dl><dt><dd>
<b>shutdown -x test
</b></dl>
<h3>Backed up files.</h3>
The following directory trees are backed up by mnx_backup:
<p>
<dl><dt><dd>
<pre>
<b>Directory	Backup disk</b>
/usr/src/kernel		1	Kernel Sources
/usr/src/fs		2	File System
/usr/src/tools		2	Kernel image and scripts
/usr/src/mm		3	Memory Manager
/usr/include		3	C-include files
/usr/src/extra		3	Miscellaneous Extra
/usr/src/.*		3	.profile etc.
</pre>
</dl>
<p>
Study this list carefully.  Notice that the library sources (/usr/src/lib)
are
<b>not
</b>backed up!  They are simply too big.  It is better to put files that you
would normally put in the library in the
<b>/usr/src/extra
</b>directory, and directly link them in with the commands that need them.<tt> </tt>
<p>
The
<b>extra
</b>directory is initially empty, you can put any data in it you want and it will
be backed up too.  Nothing else in /usr/src is backed up, except for
the files starting with a <b>'.'</b> (.profile, etc.).<tt> </tt>
<p>
The backup disks are normal MINIX file systems, and the files and
directories on them are just like the files in /usr.  Nothing stops you
from mounting a backup disk and do whatever you want with the files.<tt> </tt>
<h3>Backup Security</h3>
Floppies happen to fail, a bit of dust or a bad drive and they are gone.  So
you really need a backup's backup.  This can be done by using a second set
of floppies and calling
<b>mnx_backup
</b>twice, or by using
<b>mnx_backup
</b>on the oldest of two sets of floppies.  The latter is faster,
a little less secure, and you need to be very careful to reload the proper
set the next day.<tt> </tt>
<h3>Virtual Consoles</h3>
Try ALT-F1 / ALT-F2 or the synonyms ALT-leftarrow / ALT-rightarrow to
switch between the primary console and virtual console 2.  Note that
debug output (printf's in kernel, mm, or fs) end up on the primary console.<tt> </tt>
So run your tests on console 2, and switch to the primary console to
see if there are any messages and then switch back, etc.<tt> </tt>
<h2>SEE ALSO</h2>
<b>mkfs</b>(1),
<b>tar</b>(1),
<b>synctree</b>(1),
<b>format</b>(1).<tt> </tt>
<h2>DIAGNOSTICS</h2>
<b>Mnx_fresh</b>,
<b>mnx_backup</b>,
and
<b>mnx_restore
</b>are shell scripts.  Any errors are reported by programs such as
<b>tar</b>,
<b>mkdir</b>,
<b>mount</b>,
and
<b>synctree</b>.<tt> </tt>
<b>Synctree
</b>is very disaster tolerant, it will continue to the end.  You can easily
interrupt and restart it, that's no problem.  Note that if you interrupt
<b>mnx_backup
</b>or
<b>mnx_restore
</b>then a floppy is likely to still be mounted, use
<b>df</b>(1)
to check.<tt> </tt>
<h2>BUGS</h2>
It would have been nice if ordinary files in /usr/src were also backed up.<tt> </tt>
<p>
If anything goes wrong, you will have to restart with diskette 1.<tt> </tt>
<h2>AUTHOR</h2>
Kees J. Bot (kjb@cs.vu.nl)
<p><hr>
Markup created by <em>unroff</em> 1.0,&#160;<tt> </tt>&#160;<tt> </tt>August 19, 1997.
</body>
</html>
